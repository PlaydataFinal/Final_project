{% extends "base.html" %}
{% block content %}
{% include 'top_bottom.html' %}

<div class="product-details">
    <div class="container">
        <div class="row">
            <div class="col-7">
                <img class='img-fluid' src={% if tour.Image_URL %} {{ tour.Image_URL }} {% endif %}
                    style="min-height: 480px; margin-bottom: 10px;" alt="">
            </div>

            <div class="col-5 text-wrap">
                <div class="text-wrap fs-1 fw-bolder">이름 : {{ tour.Name }}</div>
                <div class="text-wrap fs-3 fw-bold">주소 : <br>{{ tour.Address }}<br></div>
                <div class="text-wrap fs-3 fw-bold">전화번호 : {{ tour.Tel }}</div>
                <div class="text-wrap fs-4 fw-light">태그<br> {{ tour.Tag }} </div>
            </div>
            <div class="col text-center" style="margin: 20px;">
                {% if not request.user.is_authenticated %}
                <a href="javascript:void(0)" onclick="notLogin()">
                    <span2 class="pumping" data-text="추천 {{tour.like.count}}"></span2>
                </a>
                {% elif request.user in tour.like.all %}
                <a href="javascript:void(0)" onclick="duplicatedLike()">
                    <span2 class="pumping" data-text="추천 {{tour.like.count}}"></span2>
                </a>
                {% else %}
                <a href="javascript:void(0)" data-uri="{% url 'kakaoapi:tour_like' tour.id  %}"
                    class="like text-center">
                    <span2 class="pumping" data-uri="{% url 'kakaoapi:tour_like' tour.id  %}"
                        data-text="추천 {{tour.like.count}}">
                    </span2>
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="container text-center">
        <div class="text-wrapper-23">유사한 관광지</div>
        <div class="row w-100 text-center">
            {% for test in tour_all %}
            {% if test.id == tour.rec1 %}
            <div class="col rec">
                <a href="../{{ test.id }}/"><img src="{{ test.Image_URL }}" alt="" width="280" height="200">
                    <div class="fs-4">{{ test.Name }}</div>
                </a>
            </div>
            {% endif %}

            {% if test.id == tour.rec2 %}
            <div class="col rec">
                <a href="../{{ test.id }}/"><img src="{{ test.Image_URL }}" alt="" width="280" height="200">
                    <div class="fs-4">{{ test.Name }}</div>
                </a>
            </div>
            {% endif %}

            {% if test.id == tour.rec3 %}
            <div class="col rec">
                <a href="../{{ test.id }}/"><img src="{{ test.Image_URL }}" alt="" width="280" height="200">
                    <div class="fs-4">{{ test.Name }}</div>
                </a>
            </div>
            {% endif %}

            {% endfor %}
        </div>
    </div>

    <div class="container">
        <div class="fs-1 text-wrapper-38">Reviews</div>
        <select id="form-select sort-select" onchange="location = this.value;">
            <option class="sort-date" {% if sort == '' or sort == 'date' %}selected{% endif %} value="?sort=date">최신순</option>
            <option class="sort-likes" {% if sort == 'likes' %}selected{% endif %} value="?sort=likes">좋아요순</option>
            {% if user.is_authenticated %}
            <option class="sort-mypost" {% if sort == 'mypost' %}selected{% endif %} value="?sort=mypost">내가쓴글</option>
            {% endif %}
        </select>
        <div class="row">
            <div class="col fs-4 text-wrapper-54">{{ comment.count }} Reviews</div>
        </div>
        {% for comment in comment %}
        <div class="container" style="border: 1px dotted black; margin: 10px 0px; padding: 10px;">
            <div class="row">
                <div class="col-2 fs-4 text-center text-wrapper-56">{{ comment.author.profile.nickname }}</div>

                <div class="col-5 fs-5 text-wrapper-56"></div>
                <div class="col-5">
                    {% if comment.modify_date %}
                    <div class="modify_date badge bg-light text-dark p-2 text-start mx-3">
                        <div class="mb-2 lh-base">수정된 시간</div>
                        <div>{{ comment.modify_date }}</div>
                    </div>
                    {% endif %}
                    <div class="create_date badge bg-light text-dark p-2 text-start mx-3">
                        <div class="mb-2 lh-base"> 작성된 시간<br>
                            {{ comment.create_date }}
                        </div>
                    </div>
                    <br>
                </div>
                <div class="col-2">
                    <img class="img-thumbnail" src={% if comment.author.profile.image %}
                        "{{ comment.author.profile.image.url }}" {% else %} "https://i.stack.imgur.com/34AD2.jpg" {% endif %}" />
                </div>
                <div class="col-6 fs-6 text-wrap text-wrapper-58">
                    {{ comment.comment }}
                </div>
            </div>
            {% if request.user == comment.author %}
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <a href="{% url 'kakaoapi:comment_modify' comment.id  %}"
                    class="btn btn-sm btn-outline-secondary btn-primary" style="color: aliceblue;">수정</a>
                <a href="#" class="delete btn btn-sm btn-outline-secondary btn-danger"
                    data-uri="{% url 'kakaoapi:comment_delete' comment.id  %}" style="color: aliceblue;">삭제</a>
            </div>
            {% elif not request.user.is_authenticated %}
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <a href="javascript:void(0)" onclick="notLogin()" class="btn btn-sm btn-outline-secondary"> 추천
                    <span class="badge rounded-pill bg-success">{{comment.comment_like.count}}</span>
                </a>
            </div>
            {% else %}
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <a href="javascript:void(0)" data-uri="{% url 'kakaoapi:comment_like' comment.id  %}"
                    class="like btn btn-sm btn-outline-secondary"> 추천
                    <span class="badge rounded-pill bg-success">{{comment.comment_like.count}}</span>
                </a>
            </div>
            {% endif %}
        </div>

        {% endfor %}

        {% if request.user.is_authenticated %}
        <!-- 답변 등록 -->
        <form action="{% url 'kakaoapi:comment_create' tour.id %}" method="post" class="my-3">
            {% csrf_token %}
            <!-- 오류표시 Start -->
            {% if form.errors %}
            <div class="alert alert-danger" role="alert">
                {% for field in form %}
                {% if field.errors %}
                <div>
                    <strong>{{ field.label }}</strong>
                    {{ field.errors }}
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}
            <!-- 오류표시 End -->
            <div class="mb-3">
                <label for="comment" class="form-label fs-3">리뷰 작성</label>
                <textarea name="comment" id="comment" class="form-control" rows="10"></textarea>
            </div>
            <input type="submit" value="리뷰 등록" class="btn btn-primary">
        </form>
        {% endif %}

    </div>


</div>

</div>

{% endblock %}

{% block script %}

{% endblock %}